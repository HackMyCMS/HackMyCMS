id: CVE-2024-7954-detect

info:
  name: SPIP Porte Plume Plugin - CVE-2024-7954 Detection
  author: wayko
  severity: critical
  description: |
    Detection of CVE-2024-7954 vulnerability in SPIP Porte Plume plugin without exploitation.
    Tests for the presence of the vulnerable endpoint.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2024-7954
    - https://blog.spip.net/Mise-a-jour-critique-de-securite-sortie-de-SPIP-4-3-0-alpha2-SPIP-4-2-13-SPIP-4.html
  classification:
    cve-id: CVE-2024-7954
    cvss-score: 9.8
  metadata:
    max-request: 2
    vendor: spip
    product: spip
  tags: cve,cve2024,spip,rce,detection

http:
  - method: GET
    path:
      - "{{BaseURL}}/index.php?action=porte_plume_previsu"
      - "{{BaseURL}}/ecrire/"

    redirects: true
    max-redirects: 2

    matchers-condition: and
    matchers:
      - type: regex
        regex:
          - 'porte_plume'
          - 'previsu'
          - 'SPIP'

      - type: status
        status:
          - 200
          - 302
          - 403

  - method: POST
    path:
      - "{{BaseURL}}/index.php?action=porte_plume_previsu"

    headers:
      Content-Type: application/x-www-form-urlencoded

    body: "data=test"

    redirects: true
    max-redirects: 2

    matchers-condition: or
    matchers:
      - type: word
        words:
          - 'Composed-By: SPIP'
          - 'X-Spip-Cache'
          - 'porte_plume'

      - type: regex
        regex:
          - 'SPIP [0-9]+\.[0-9]+'

      - type: status
        status:
          - 200